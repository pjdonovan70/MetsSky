<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetsSky | The Dynasty</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; background-image: radial-gradient(at 0% 0%, #002D72 0, transparent 50%), radial-gradient(at 100% 100%, #FF5910 0, transparent 50%); background-attachment: fixed; }
        .glass-panel { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); }
        .glass-input { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); color: white; transition: all 0.2s; }
        .glass-input:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        .mets-orange { color: #FF5910; }
        .mets-blue { color: #002D72; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .text-glow { text-shadow: 0 0 20px rgba(255, 89, 16, 0.5); }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); } 100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); } }
        .pulse-dot { animation: pulse-green 2s infinite; }
        .chat-anim { animation: slide-up 0.3s ease-out; }
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="text-slate-200 font-sans selection:bg-orange-500/30">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- ICONS ---
        const Icons = {
            Trash2: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Link: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            ArrowRight: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
            RefreshCw: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
            Plus: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Calendar: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Check: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>,
            X: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Users: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            ClipboardList: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>,
            Home: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Tv: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="15" x="2" y="7" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>,
            ExternalLink: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>,
            Play: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Radio: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M2 12h.01"/></svg>,
            MessageSquare: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Palmtree: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M13 8c0-2.76-2.46-5-5.5-5S2 5.24 2 8h2c0-1.66 1.57-3 3.5-3S11 6.34 11 8h2z"/><path d="M13 7.14A5.82 5.82 0 0 1 16.5 6c3.04 0 5.5 2.24 5.5 5h-2c0-1.66-1.57-3-3.5-3s-3.5 1.34-3.5 3h-2c0-1.56 1.06-2.9 2.5-3.86z"/><path d="M11 22h2v-6h-2v6z"/><path d="M7 22h2v-8H7v8z"/><path d="M15 22h2v-8h-2v8z"/></svg>,
            Edit2: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            FileText: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Briefcase: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
            Database: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            ChevronDown: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>,
            ChevronUp: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m18 15-6-6-6 6"/></svg>,
            Send: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Minimize2: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/></svg>,
            Cloud: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5c-1.45 0-2.748.59-3.714 1.541A5.496 5.496 0 0 0 6 13.5A5.506 5.506 0 0 0 11.5 19h6Z"/><path d="M17.5 19c2.485 0 4.5-2.015 4.5-4.5S19.985 10 17.5 10c-.16 0-.317.009-.471.025A5.5 5.5 0 0 0 12 5c-2.598 0-4.766 1.814-5.316 4.233A5.503 5.503 0 0 0 2 13.5C2 16.537 4.463 19 7.5 19h10Z"/></svg>,
            ArrowUpCircle: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4"/><path d="M12 16V8"/></svg>,
            ArrowDownCircle: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m16 12-4 4-4-4"/><path d="M12 8v8"/></svg>,
            Activity: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            DollarSign: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Flame: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3.7 2 2.5 3 2.9 4.3z"/></svg>,
            Search: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Newspaper: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6Z"/></svg>,
            LogOut: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            BookOpen: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        };

        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAkDUZZnh_AoKhBe-ntB1I4-QJKyiaEeg8",
            authDomain: "rollcall-e5e3a.firebaseapp.com",
            projectId: "rollcall-e5e3a",
            storageBucket: "rollcall-e5e3a.firebasestorage.app",
            messagingSenderId: "301776745476",
            appId: "1:301776745476:web:49d23434d590135c7df151"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- COMMENT COMPONENT ---
        const CommentSection = ({ parentId, currentUser }) => {
            const [comments, setComments] = useState([]);
            const [newComment, setNewComment] = useState('');
            const [isOpen, setIsOpen] = useState(false);

            useEffect(() => {
                if(!isOpen) return;
                const unsub = db.collection('mets_comments')
                    .where('parentId', '==', parentId)
                    .onSnapshot(snap => {
                        const loaded = snap.docs.map(d => ({id: d.id, ...d.data()}));
                        loaded.sort((a,b) => (a.createdAt?.seconds || 0) - (b.createdAt?.seconds || 0));
                        setComments(loaded);
                    });
                return () => unsub();
            }, [isOpen, parentId]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if(!newComment.trim() || !currentUser) return;
                await db.collection('mets_comments').add({
                    parentId,
                    text: newComment,
                    authorId: currentUser.uid,
                    authorName: currentUser.displayName || currentUser.email.split('@')[0],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                setNewComment('');
            };

            const handleDelete = async (id) => {
                if(confirm("Delete comment?")) await db.collection('mets_comments').doc(id).delete();
            };

            if(!isOpen) {
                return (
                    <button onClick={() => setIsOpen(true)} className="text-xs text-slate-500 hover:text-white flex items-center gap-1 mt-2">
                        <Icons.MessageSquare className="w-3 h-3"/> Show Comments
                    </button>
                );
            }

            return (
                <div className="mt-3 pt-3 border-t border-white/5 animate-fade-in w-full">
                    <div className="space-y-2 mb-3 max-h-48 overflow-y-auto custom-scrollbar">
                        {comments.map(c => (
                            <div key={c.id} className="bg-black/20 p-2 rounded text-xs">
                                <div className="flex justify-between items-start">
                                    <span className="font-bold text-slate-400">{c.authorName}</span>
                                    {currentUser && (currentUser.uid === c.authorId) && (
                                        <button onClick={() => handleDelete(c.id)} className="text-slate-600 hover:text-red-500"><Icons.X className="w-3 h-3"/></button>
                                    )}
                                </div>
                                <div className="text-white mt-0.5">{c.text}</div>
                            </div>
                        ))}
                        {comments.length === 0 && <div className="text-slate-600 italic text-xs">No comments yet.</div>}
                    </div>
                    {currentUser ? (
                        <form onSubmit={handleSubmit} className="flex gap-2">
                            <input 
                                type="text" 
                                className="flex-1 bg-slate-900/50 border border-white/10 rounded-lg px-3 py-1 text-xs text-white focus:outline-none focus:border-blue-500"
                                placeholder="Write a comment..."
                                value={newComment}
                                onChange={e => setNewComment(e.target.value)}
                            />
                            <button type="submit" className="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded-lg text-xs font-bold">Post</button>
                        </form>
                    ) : (
                        <div className="text-center text-xs text-slate-500 bg-slate-900/30 p-2 rounded">
                            Log in to comment
                        </div>
                    )}
                    <button onClick={() => setIsOpen(false)} className="text-[10px] text-slate-500 hover:text-white mt-2 w-full text-center">Hide Comments</button>
                </div>
            );
        };

        // --- CHAT COMPONENT ---
        const ChatBox = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [username, setUsername] = useState(localStorage.getItem('mets_chat_username') || '');
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [tempName, setTempName] = useState('');
            const scrollRef = useRef(null);

            useEffect(() => {
                const q = db.collection('mets_chat').orderBy('createdAt', 'asc').limitToLast(50);
                const unsubscribe = q.onSnapshot(snapshot => {
                    const msgs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setMessages(msgs);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (scrollRef.current) {
                    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
                }
            }, [messages, isOpen]);

            const handleLogin = (e) => {
                e.preventDefault();
                if (!tempName.trim()) return;
                setUsername(tempName);
                localStorage.setItem('mets_chat_username', tempName);
            };

            const handleSend = async (e) => {
                e.preventDefault();
                if (!inputText.trim()) return;
                await db.collection('mets_chat').add({
                    text: inputText,
                    sender: username,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                setInputText('');
            };

            if (!isOpen) {
                return (
                    <button 
                        onClick={() => setIsOpen(true)} 
                        className="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-full shadow-2xl z-50 border-2 border-orange-500 transition-all hover:scale-110"
                    >
                        <Icons.MessageSquare className="w-8 h-8" />
                    </button>
                );
            }

            return (
                <div className="fixed bottom-6 right-6 w-80 md:w-96 bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl z-50 flex flex-col overflow-hidden chat-anim" style={{height: '500px', maxHeight: '80vh'}}>
                    <div className="bg-blue-600/20 p-4 flex justify-between items-center border-b border-white/10 cursor-pointer" onClick={() => setIsOpen(false)}>
                        <div className="flex items-center gap-2">
                            <span className="text-xl">‚öæ</span>
                            <span className="font-black text-white">Bullpen Chat</span>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={(e) => { e.stopPropagation(); setIsOpen(false); }}><Icons.Minimize2 className="w-4 h-4 text-slate-300 hover:text-white"/></button>
                            <button onClick={(e) => { e.stopPropagation(); setIsOpen(false); }}><Icons.X className="w-4 h-4 text-slate-300 hover:text-white"/></button>
                        </div>
                    </div>

                    {!username ? (
                        <div className="flex-1 flex flex-col items-center justify-center p-6 text-center space-y-4">
                            <div className="text-5xl">üèüÔ∏è</div>
                            <h3 className="text-white font-bold">Enter the Lobby</h3>
                            <p className="text-slate-400 text-sm">Pick a name to start chatting with the squad.</p>
                            <form onSubmit={handleLogin} className="w-full space-y-2">
                                <input 
                                    type="text" 
                                    placeholder="Your Name..." 
                                    className="w-full bg-slate-800 border border-white/10 rounded-xl p-3 text-white focus:border-orange-500 outline-none text-center"
                                    value={tempName}
                                    onChange={e => setTempName(e.target.value)}
                                />
                                <button type="submit" className="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 rounded-xl">Join Chat</button>
                            </form>
                        </div>
                    ) : (
                        <>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar" ref={scrollRef}>
                                {messages.map(msg => (
                                    <div key={msg.id} className={`flex flex-col ${msg.sender === username ? 'items-end' : 'items-start'}`}>
                                        <div className="text-[10px] text-slate-500 mb-1 px-1 font-bold">{msg.sender}</div>
                                        <div className={`px-3 py-2 rounded-xl text-sm max-w-[85%] break-words ${msg.sender === username ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-slate-800 text-slate-200 rounded-tl-none'}`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                {messages.length === 0 && <div className="text-center text-slate-600 italic text-xs mt-10">Quiet in the bullpen...</div>}
                            </div>
                            
                            <form onSubmit={handleSend} className="p-3 bg-black/20 border-t border-white/5 flex gap-2">
                                <input 
                                    type="text" 
                                    placeholder="Talk smack..." 
                                    className="flex-1 bg-slate-800 border border-white/10 rounded-xl px-3 py-2 text-white focus:outline-none focus:border-blue-500 text-sm"
                                    value={inputText}
                                    onChange={e => setInputText(e.target.value)}
                                />
                                <button type="submit" className="bg-orange-600 hover:bg-orange-500 text-white p-2 rounded-xl"><Icons.Send className="w-4 h-4"/></button>
                            </form>
                        </>
                    )}
                </div>
            );
        };

        // --- NEW COUNTDOWN COMPONENT ---
        const CountdownTicket = () => {
            const [data, setData] = useState({ title: 'Opening Day', date: '2026-03-28' }); // Default
            const [isEditing, setIsEditing] = useState(false);
            const [tempData, setTempData] = useState(data);

            useEffect(() => {
                const unsub = db.collection('mets_settings').doc('countdown').onSnapshot(doc => {
                    if (doc.exists) {
                        setData(doc.data());
                        setTempData(doc.data());
                    }
                });
                return () => unsub();
            }, []);

            const handleSave = async () => {
                if(!tempData.title || !tempData.date) return;
                await db.collection('mets_settings').doc('countdown').set(tempData);
                setIsEditing(false);
            };

            const today = new Date();
            today.setHours(0,0,0,0);
            const target = new Date(data.date);
            // Fix timezone offset issue by forcing target to midnight local
            const targetLocal = new Date(target.getUTCFullYear(), target.getUTCMonth(), target.getUTCDate());
            
            const diffTime = targetLocal - today;
            const daysLeft = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            const displayDays = daysLeft < 0 ? 0 : daysLeft;

            return (
                <div className="glass-panel p-6 rounded-3xl border-l-8 border-orange-500 relative group flex flex-col md:flex-row items-center justify-between gap-6 animate-fade-in">
                    <button onClick={() => setIsEditing(!isEditing)} className="absolute top-4 right-4 text-slate-600 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Edit2 className="w-4 h-4"/></button>
                    
                    {isEditing ? (
                        <div className="w-full flex flex-col md:flex-row gap-4 items-center">
                             <div className="flex-1 w-full">
                                <label className="text-[10px] uppercase font-bold text-slate-500">Event Title</label>
                                <input type="text" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500 font-bold" value={tempData.title} onChange={e => setTempData({...tempData, title: e.target.value})} />
                            </div>
                            <div className="w-full md:w-auto">
                                <label className="text-[10px] uppercase font-bold text-slate-500">Target Date</label>
                                <input type="date" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={tempData.date} onChange={e => setTempData({...tempData, date: e.target.value})} />
                            </div>
                            <div className="flex gap-2 mt-4 md:mt-0">
                                <button onClick={handleSave} className="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-xl font-bold text-sm">Save</button>
                                <button onClick={() => setIsEditing(false)} className="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-xl font-bold text-sm">Cancel</button>
                            </div>
                        </div>
                    ) : (
                        <>
                            <div className="flex items-center gap-6">
                                <div className="bg-black/30 p-4 rounded-2xl border border-white/10 text-center min-w-[100px]">
                                    <div className="text-5xl font-black text-white tabular-nums tracking-tighter">{displayDays}</div>
                                    <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Days Left</div>
                                </div>
                                <div>
                                    <div className="text-xs font-bold text-blue-400 uppercase tracking-widest mb-1">Countdown To</div>
                                    <h2 className="text-3xl md:text-4xl font-black text-white italic uppercase tracking-tight">{data.title}</h2>
                                    <div className="text-sm text-slate-500 font-bold mt-1">{new Date(data.date + 'T12:00:00').toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                                </div>
                            </div>
                            <div className="hidden md:block">
                                <Icons.Calendar className="w-16 h-16 text-white/5" />
                            </div>
                        </>
                    )}
                </div>
            );
        };

        const ScheduleCard = ({ game, onUpdate, onDelete }) => {
            const [isEditing, setIsEditing] = useState(false); 
            const [editResult, setEditResult] = useState(game.result || 'Pending');
            const [editScoreUs, setEditScoreUs] = useState(game.scoreUs || ''); 
            const [editScoreThem, setEditScoreThem] = useState(game.scoreThem || ''); 
            const [isLinkOpen, setIsLinkOpen] = useState(false);
            const [isNoteOpen, setIsNoteOpen] = useState(false);
            const [noteText, setNoteText] = useState(game.notes || '');
            const [newLinkTitle, setNewLinkTitle] = useState(''); 
            const [newLinkUrl, setNewLinkUrl] = useState('');

            const handleSave = () => { onUpdate(game.id, { result: editResult, scoreUs: editScoreUs, scoreThem: editScoreThem }); setIsEditing(false); };
            const handleSaveNote = () => { onUpdate(game.id, { notes: noteText }); setIsNoteOpen(false); };
            const addLink = () => { if (!newLinkTitle || !newLinkUrl) return; const links = game.links || []; onUpdate(game.id, { links: [...links, { title: newLinkTitle, url: newLinkUrl }] }); setNewLinkTitle(''); setNewLinkUrl(''); };
            const removeLink = (idx) => { const links = [...(game.links || [])]; links.splice(idx, 1); onUpdate(game.id, { links }); };
            
            const borderColor = game.location === 'Home' ? 'border-blue-500' : 'border-orange-500';

            return ( 
                <div className={`glass-panel p-4 rounded-2xl border-l-4 ${borderColor} group hover:bg-white/5 transition-colors`}>
                    <div className="flex justify-between items-start">
                        <div className="flex-1">
                            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                {game.gameType === 'Spring' ? <Icons.Palmtree className="w-3 h-3 text-yellow-500"/> : ''} {game.date} {game.time && <span>‚Ä¢ {game.time}</span>} <span className="text-slate-600">‚Ä¢</span> {game.location}
                            </div>
                            <div className="text-xl font-black text-white mt-1">{game.opponent}</div>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="flex items-center gap-2 bg-black/20 p-1 rounded-lg border border-white/5">
                                <select className={`bg-transparent text-xs font-bold focus:outline-none ${editResult === 'W' ? 'text-green-400' : editResult === 'L' ? 'text-red-400' : 'text-slate-400'}`} value={editResult} onChange={(e) => { setEditResult(e.target.value); onUpdate(game.id, { result: e.target.value, scoreUs: editScoreUs, scoreThem: editScoreThem }); }}><option value="Pending">-</option><option value="W">W</option><option value="L">L</option></select>
                                <div className="h-4 w-px bg-white/10"></div>
                                <div className="flex items-center gap-1"><input type="text" className="w-6 bg-transparent text-center text-sm text-white font-bold focus:outline-none" placeholder="-" value={editScoreUs} onChange={(e) => setEditScoreUs(e.target.value)} onBlur={() => onUpdate(game.id, { scoreUs: editScoreUs, scoreThem: editScoreThem })} /><span className="text-slate-600 text-xs">:</span><input type="text" className="w-6 bg-transparent text-center text-sm text-white font-bold focus:outline-none" placeholder="-" value={editScoreThem} onChange={(e) => setEditScoreThem(e.target.value)} onBlur={() => onUpdate(game.id, { scoreUs: editScoreUs, scoreThem: editScoreThem })} /></div>
                            </div>
                            <button onClick={() => onDelete(game.id)} className="p-2 text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4"/></button>
                        </div>
                    </div>
                    
                    <div className="mt-3 pt-3 border-t border-white/5">
                        <div className="flex gap-4">
                            <button onClick={() => { setIsNoteOpen(!isNoteOpen); setIsLinkOpen(false); }} className={`flex-1 text-[10px] font-bold uppercase tracking-wider flex items-center justify-center gap-2 py-1 rounded transition-colors ${game.notes ? 'text-yellow-400 bg-yellow-900/10' : 'text-slate-500 hover:bg-white/5 hover:text-white'}`}><Icons.FileText className="w-3 h-3"/> Notes {game.notes && '‚úì'}</button>
                            <div className="w-px bg-white/10"></div>
                            <button onClick={() => { setIsLinkOpen(!isLinkOpen); setIsNoteOpen(false); }} className={`flex-1 text-[10px] font-bold uppercase tracking-wider flex items-center justify-center gap-2 py-1 rounded transition-colors ${game.links?.length > 0 ? 'text-blue-400 bg-blue-900/10' : 'text-slate-500 hover:bg-white/5 hover:text-white'}`}><Icons.Link className="w-3 h-3"/> Recaps ({game.links?.length || 0})</button>
                        </div>

                        {isNoteOpen && (
                            <div className="mt-3 animate-fade-in">
                                <textarea className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-sm text-slate-200 focus:border-yellow-500/50 outline-none min-h-[80px] mb-2" placeholder="Game notes..." value={noteText} onChange={(e) => setNoteText(e.target.value)}></textarea>
                                <div className="flex justify-end gap-2"><button onClick={() => setIsNoteOpen(false)} className="text-xs text-slate-500 hover:text-white px-3 py-1">Cancel</button><button onClick={handleSaveNote} className="text-xs bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-1 rounded-lg font-bold">Save Note</button></div>
                            </div>
                        )}

                        {isLinkOpen && (
                            <div className="mt-3 space-y-2 animate-fade-in">
                                {game.links && game.links.map((link, idx) => (<div key={idx} className="flex justify-between items-center bg-slate-900/30 p-2 rounded text-xs border border-white/5 hover:border-white/10"><a href={link.url} target="_blank" className="text-blue-400 hover:underline truncate flex-1 font-medium">{link.title}</a><button onClick={() => removeLink(idx)} className="text-slate-600 hover:text-red-500 ml-2"><Icons.Trash2 className="w-3 h-3"/></button></div>))}
                                <div className="flex gap-2 mt-2"><input type="text" placeholder="Title" className="bg-slate-900/50 border border-white/10 rounded p-2 text-xs text-white flex-1 focus:border-blue-500 outline-none" value={newLinkTitle} onChange={e => setNewLinkTitle(e.target.value)} /><input type="text" placeholder="URL" className="bg-slate-900/50 border border-white/10 rounded p-2 text-xs text-white flex-1 focus:border-blue-500 outline-none" value={newLinkUrl} onChange={e => setNewLinkUrl(e.target.value)} /><button onClick={addLink} className="bg-slate-700 text-white px-3 rounded text-xs font-bold hover:bg-blue-600 transition-colors">+</button></div>
                            </div>
                        )}
                    </div>
                </div> 
            );
        };

        const RantCard = ({ rant, onDelete, currentUser }) => (
            <div className="glass-panel p-5 rounded-2xl border border-white/5 relative group">
                <div className="flex justify-between items-center mb-2">
                    <div className="flex items-center gap-2">
                        <div className={`w-2 h-2 rounded-full ${rant.mood === 'Happy' ? 'bg-green-500' : rant.mood === 'Angry' ? 'bg-red-500' : 'bg-yellow-500'}`}></div>
                        <span className="text-xs font-bold uppercase text-slate-500">{rant.date}</span>
                    </div>
                    {(currentUser && currentUser.uid === rant.authorId) && (
                        <button onClick={() => onDelete(rant.id)} className="text-slate-600 hover:text-red-500 transition-colors">
                            <Icons.Trash2 className="w-4 h-4" />
                        </button>
                    )}
                </div>
                <div className="text-lg font-bold text-white mb-1">{rant.topic}</div>
                <p className="text-slate-300 text-sm leading-relaxed mb-3">{rant.content}</p>
                <div className="border-t border-white/5 pt-2 flex items-center gap-2">
                    {rant.authorPhoto ? <img src={rant.authorPhoto} className="w-5 h-5 rounded-full" /> : <div className="w-5 h-5 rounded-full bg-slate-700"></div>}
                    <span className="text-[10px] font-bold text-blue-400">{rant.authorName || 'Anonymous Fan'}</span>
                </div>
                <CommentSection parentId={rant.id} currentUser={currentUser} />
            </div>
        );

        const PlayerCard = ({ player, onDelete }) => (
            <div className="glass-panel p-4 rounded-2xl border border-white/10 relative group hover:border-blue-500/50 transition-all">
                <button onClick={() => onDelete(player.id)} className="absolute top-3 right-3 text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4" /></button>
                <div className="flex items-center gap-4">
                    <div className={`h-12 w-12 rounded-full flex items-center justify-center font-black text-lg border-2 ${player.status === 'Hot' ? 'border-green-500 text-green-400 bg-green-900/20' : player.status === 'Cold' ? 'border-blue-400 text-blue-300 bg-blue-900/20' : 'border-red-500 text-red-400 bg-red-900/20'}`}>{player.number}</div>
                    <div>
                        <div className="font-bold text-white text-lg">{player.name}</div>
                        <div className={`text-xs font-bold uppercase tracking-wider ${player.status === 'Hot' ? 'text-green-400' : player.status === 'Cold' ? 'text-blue-400' : 'text-red-400'}`}>{player.status === 'Trade' ? 'TRADE BAIT' : player.status}</div>
                    </div>
                </div>
                <div className="mt-3 text-sm text-slate-400 border-t border-white/5 pt-2">{player.notes}</div>
            </div>
        );

        const LinkCard = ({ link, onDelete }) => (
            <div className="glass-panel p-4 rounded-2xl border border-white/10 hover:bg-white/5 transition-all flex justify-between items-center group">
                <div className="flex items-center gap-3 overflow-hidden">
                    <div className="bg-blue-600/20 p-2 rounded-lg text-blue-400"><Icons.Link className="w-5 h-5" /></div>
                    <a href={link.url} target="_blank" className="text-white font-bold hover:text-orange-400 transition-colors truncate block">{link.title}</a>
                </div>
                <button onClick={() => onDelete(link.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4" /></button>
            </div>
        );
        
        const TransactionCard = ({ transaction, onDelete }) => {
            const typeStyles = { Lost: 'border-red-500/50 bg-red-900/10', Signed: 'border-green-500/50 bg-green-900/10', Trade: 'border-blue-500/50 bg-blue-900/10', DFA: 'border-red-500/50 bg-red-900/10', Waivers: 'border-yellow-500/50 bg-yellow-900/10', Optioned: 'border-slate-500/50 bg-slate-900/10', Promoted: 'border-green-500/50 bg-green-900/10', IL: 'border-red-500/50 bg-red-900/10', Extension: 'border-green-500/50 bg-green-900/10' };
            const typeIcons = { Lost: <Icons.X className="w-5 h-5 text-red-400"/>, Signed: <Icons.Check className="w-5 h-5 text-green-400"/>, Trade: <Icons.RefreshCw className="w-5 h-5 text-blue-400"/>, DFA: <Icons.X className="w-5 h-5 text-red-400"/>, Waivers: <Icons.FileText className="w-5 h-5 text-yellow-400"/>, Optioned: <Icons.ArrowDownCircle className="w-5 h-5 text-slate-400"/>, Promoted: <Icons.ArrowUpCircle className="w-5 h-5 text-green-400"/>, IL: <Icons.Activity className="w-5 h-5 text-red-400"/>, Extension: <Icons.Check className="w-5 h-5 text-green-400"/> };
            return ( 
                <div className={`glass-panel p-4 rounded-2xl border-l-4 relative group ${typeStyles[transaction.type]}`}>
                    <div className="flex justify-between items-start mb-1">
                        <div className="flex items-center gap-2">{typeIcons[transaction.type] || <Icons.ArrowRight className="w-5 h-5"/>}<span className="text-xs font-bold text-slate-400 uppercase tracking-wider">{transaction.type}</span></div>
                        <button onClick={() => onDelete(transaction.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4" /></button>
                    </div>
                    <div className="font-black text-white text-lg mt-1">{transaction.player}</div>
                    <div className="flex items-center gap-2 text-sm text-slate-300 mt-1"><span>{transaction.fromTeam || "Internal"}</span><Icons.ArrowRight className="w-3 h-3 text-slate-500"/><span className="font-bold text-white">{transaction.toTeam || "Market"}</span></div>
                    {transaction.notes && <div className="mt-2 pt-2 border-t border-white/5 text-xs text-slate-400 italic">{transaction.notes}</div>}
                </div> 
            );
        };
        
        const SquadMember = ({ member, onUpdate, onDelete, showStatus = false, isArchived = false }) => {
            const [isNoteOpen, setIsNoteOpen] = useState(false); 
            const [noteText, setNoteText] = useState(member.notes || '');
            
            const handleSaveNote = () => { onUpdate(member.id, { notes: noteText }); setIsNoteOpen(false); };
            const restorePlayer = () => { onUpdate(member.id, { status: 'Active (30-Man)' }); };
            const moveToMinors = () => onUpdate(member.id, { status: '40-Man / Minors' });
            const moveToActive = () => onUpdate(member.id, { status: 'Active (30-Man)' });
            const moveToIL = () => onUpdate(member.id, { status: 'Injured List (IL)' });

            return ( 
                <div className={`flex flex-col p-4 hover:bg-white/5 group transition-colors border-b border-white/5 last:border-0 ${isArchived ? 'opacity-60 hover:opacity-100' : ''}`}>
                    <div className="flex justify-between items-center">
                        <div className="flex items-center gap-3">
                            <span className="font-mono text-slate-500 text-sm w-8 font-bold">#{member.number}</span>
                            {member.mlbId ? (
                                <a href={`https://www.mlb.com/player/${member.mlbId}`} target="_blank" className={`font-bold hover:underline hover:text-blue-400 transition-colors flex items-center gap-1 ${isArchived ? 'text-slate-500 line-through' : 'text-white'}`}>
                                    {member.name}<Icons.ExternalLink className="w-3 h-3 opacity-50"/>
                                </a>
                            ) : (
                                <span className={`font-bold ${isArchived ? 'text-slate-500 line-through' : 'text-white'}`}>{member.name}</span>
                            )}
                            <span className="text-xs text-slate-500 ml-2 font-normal">({member.position})</span>
                            {!isArchived && <span className="text-[10px] font-bold text-slate-600 bg-white/5 px-1.5 py-0.5 rounded border border-white/5">{member.throws}</span>}
                            {showStatus && (<span className={`text-[10px] uppercase font-bold px-2 py-1 rounded ml-2 border ${member.status === 'Active (30-Man)' ? 'text-green-400 border-green-500/30 bg-green-900/10' : member.status === '40-Man / Minors' ? 'text-slate-400 border-slate-500/30 bg-slate-900/10' : 'text-red-400 border-red-500/30 bg-red-900/10'}`}>{member.status === 'Active (30-Man)' ? 'Active' : member.status === '40-Man / Minors' ? 'Minors' : 'IL'}</span>)}
                            <div className="flex gap-1 ml-2">
                                <button onClick={() => { setIsNoteOpen(!isNoteOpen); }} className={`p-1 rounded hover:bg-white/10 transition-colors ${member.notes ? 'text-yellow-400' : 'text-slate-600 group-hover:text-slate-400'}`} title="Notes"><Icons.FileText className="w-3 h-3"/></button>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            {!isArchived && (<div className="flex gap-1 mr-2 border-r border-white/10 pr-2">{member.status === 'Active (30-Man)' && (<><button onClick={moveToMinors} title="Send to Minors/40-Man" className="p-1 rounded text-slate-400 hover:text-white hover:bg-slate-700 transition-colors"><Icons.ArrowDownCircle className="w-4 h-4" /></button><button onClick={moveToIL} title="Place on IL" className="p-1 rounded text-red-400/50 hover:text-red-400 hover:bg-red-900/20 transition-colors"><Icons.Activity className="w-4 h-4" /></button></>)}{member.status === '40-Man / Minors' && (<button onClick={moveToActive} title="Call Up to Active Roster" className="p-1 rounded text-green-500/70 hover:text-green-400 hover:bg-green-900/20 transition-colors"><Icons.ArrowUpCircle className="w-4 h-4" /></button>)}{member.status === 'Injured List (IL)' && (<button onClick={moveToActive} title="Activate from IL" className="p-1 rounded text-green-500/70 hover:text-green-400 hover:bg-green-900/20 transition-colors"><Icons.ArrowUpCircle className="w-4 h-4" /></button>)}</div>)}
                            {isArchived && <button onClick={restorePlayer} className="text-xs bg-blue-900/30 text-blue-400 px-2 py-1 rounded hover:bg-blue-900/50 mr-2">Restore</button>}
                            <button onClick={() => onDelete(member.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4"/></button>
                        </div>
                    </div>
                    {isNoteOpen && (<div className="mt-3 ml-11 animate-fade-in"><label className="text-[10px] uppercase font-bold text-slate-500 mb-1 block">Player Notes / Scouting Report</label><textarea className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-sm text-slate-200 focus:border-yellow-500/50 outline-none min-h-[80px]" placeholder="Enter notes..." value={noteText} onChange={(e) => setNoteText(e.target.value)}></textarea><div className="flex justify-end gap-2 mt-2"><button onClick={() => setIsNoteOpen(false)} className="text-xs text-slate-500 hover:text-white px-3 py-1">Cancel</button><button onClick={handleSaveNote} className="text-xs bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-1 rounded-lg font-bold">Save Note</button></div></div>)}
                </div> 
            );
        };

        const MediaBoard = ({ channels, onAddChannel, onDeleteChannel }) => {
             const [newChannelName, setNewChannelName] = useState(''); 
             const [newChannelUrl, setNewChannelUrl] = useState(''); 
             const [videos, setVideos] = useState([]);
             const [loading, setLoading] = useState(false);

             const handleAdd = (e) => { 
                 e.preventDefault(); 
                 onAddChannel({ name: newChannelName, url: newChannelUrl }); 
                 setNewChannelName(''); 
                 setNewChannelUrl(''); 
             };

             const loadFeeds = async () => {
                setLoading(true);
                const rssUrls = [];
                
                // 1. Official Hardcoded Mets/SNY Feeds
                rssUrls.push('https://www.youtube.com/feeds/videos.xml?channel_id=UCJ5t17X9J7sXU7Q4lC7sX7g'); // Mets
                rssUrls.push('https://www.youtube.com/feeds/videos.xml?channel_id=UCMK264qQk8Xh7j1wZ_8o36w'); // SNY

                // 2. Dynamic Feeds from User Channels
                channels.forEach(ch => {
                    if(!ch.url) return;
                    let match = ch.url.match(/channel\/(UC[\w-]+)/);
                    if(match && match[1]) {
                        rssUrls.push(`https://www.youtube.com/feeds/videos.xml?channel_id=${match[1]}`);
                    }
                    else if (ch.url.includes('playlist?list=')) {
                        match = ch.url.match(/list=([\w-]+)/);
                        if(match && match[1]) {
                            rssUrls.push(`https://www.youtube.com/feeds/videos.xml?playlist_id=${match[1]}`);
                        }
                    }
                });
                
                try {
                    const uniqueUrls = [...new Set(rssUrls)];
                    const responses = await Promise.all(uniqueUrls.map(url => 
                        fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`).then(res => res.json())
                    ));
                    
                    let allVideos = [];
                    responses.forEach(feed => {
                        if(feed.status === 'ok') {
                            allVideos = [...allVideos, ...feed.items];
                        }
                    });
                    
                    allVideos.sort((a,b) => new Date(b.pubDate) - new Date(a.pubDate));
                    setVideos(allVideos.slice(0, 12));
                } catch (e) { console.error(e); } finally { setLoading(false); }
             };

             useEffect(() => { loadFeeds(); }, [channels]);

             return ( 
                <div className="space-y-8 animate-fade-in">
                    <div className="glass-panel p-6 rounded-3xl border border-slate-700">
                        <h3 className="text-lg font-black text-white mb-4">Add Channel / Link</h3>
                        <form onSubmit={handleAdd} className="flex flex-col md:flex-row gap-4">
                            <input type="text" placeholder="Name (e.g. Mets'd Up)" className="flex-1 bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newChannelName} onChange={e => setNewChannelName(e.target.value)} required />
                            <input type="text" placeholder="YouTube Link (Use channel/ID format for auto-sync)" className="flex-[2] bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newChannelUrl} onChange={e => setNewChannelUrl(e.target.value)} required />
                            <button type="submit" className="bg-orange-600 hover:bg-orange-500 text-white font-bold px-6 py-3 rounded-xl shadow-lg">Add</button>
                        </form>
                    </div>

                    <div>
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-xl font-black text-white flex items-center gap-2"><Icons.Play className="w-5 h-5 text-red-500"/> Video Wall (Latest)</h2>
                            <button onClick={loadFeeds} className="text-xs bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-xl border border-white/10 font-bold transition-all flex items-center gap-2"><Icons.RefreshCw className={`w-3 h-3 ${loading ? 'animate-spin' : ''}`}/> REFRESH FEEDS</button>
                        </div>
                        {loading ? <div className="text-slate-500 animate-pulse">Scanning user channels...</div> : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {videos.map((vid, i) => (
                                    <a key={i} href={vid.link} target="_blank" className="glass-panel rounded-2xl overflow-hidden group hover:scale-[1.02] transition-all block border border-white/10">
                                        <div className="relative aspect-video bg-black">
                                            <img src={vid.thumbnail} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="bg-red-600 text-white p-3 rounded-full shadow-lg scale-90 group-hover:scale-110 transition-transform"><Icons.Play className="w-6 h-6 fill-current"/></div>
                                            </div>
                                        </div>
                                        <div className="p-4">
                                            <div className="text-[10px] text-slate-500 uppercase font-bold mb-1">{vid.author} ‚Ä¢ {vid.pubDate.split(' ')[0]}</div>
                                            <h3 className="text-white font-bold text-sm leading-snug line-clamp-2 group-hover:text-blue-400 transition-colors">{vid.title}</h3>
                                        </div>
                                    </a>
                                ))}
                                {videos.length === 0 && <div className="col-span-full text-center text-slate-500 italic">No videos found. Add YouTube channels with "/channel/ID" links to populate this wall.</div>}
                            </div>
                        )}
                    </div>

                    <div>
                        <h2 className="text-xl font-black text-white flex items-center gap-2 mb-4"><Icons.Tv className="w-5 h-5 text-yellow-500"/> Channel Directory</h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            {channels.map(channel => (
                                <div key={channel.id} className="glass-panel p-4 rounded-2xl border border-white/10 flex justify-between items-center group">
                                    <a href={channel.url} target="_blank" className="flex items-center gap-3 overflow-hidden">
                                        <div className="bg-slate-800 p-2 rounded-lg text-slate-400"><Icons.Link className="w-4 h-4"/></div>
                                        <span className="text-white font-bold truncate hover:text-orange-400 transition-colors">{channel.name}</span>
                                    </a>
                                    <button onClick={() => onDeleteChannel(channel.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4"/></button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div> 
            );
        };
        const DatabaseItem = ({ item, onUpdate, onDelete }) => {
            const [isExpanded, setIsExpanded] = useState(false); 
            const [newLinkTitle, setNewLinkTitle] = useState(''); 
            const [newLinkUrl, setNewLinkUrl] = useState('');
            const addLink = () => { if (!newLinkTitle || !newLinkUrl) return; const links = item.links || []; onUpdate(item.id, { links: [...links, { title: newLinkTitle, url: newLinkUrl }] }); setNewLinkTitle(''); setNewLinkUrl(''); };
            const removeLink = (idx) => { const links = [...(item.links || [])]; links.splice(idx, 1); onUpdate(item.id, { links }); };
            return ( 
                <div className="glass-panel p-5 rounded-2xl border border-white/5 hover:border-white/20 transition-all group">
                    <div className="flex justify-between items-center cursor-pointer" onClick={() => setIsExpanded(!isExpanded)}>
                        <div className="flex items-center gap-4">
                            <div className="bg-slate-800 p-3 rounded-xl text-slate-300 group-hover:text-white transition-colors">{item.type === 'year' ? <Icons.Calendar className="w-6 h-6"/> : <Icons.Users className="w-6 h-6"/>}</div>
                            <span className="text-xl font-black text-white">{item.name}</span>
                        </div>
                        <div className="flex items-center gap-3"><span className="text-xs font-bold text-slate-500 uppercase tracking-widest">{item.links?.length || 0} Links</span>{isExpanded ? <Icons.ChevronUp className="w-5 h-5 text-slate-400"/> : <Icons.ChevronDown className="w-5 h-5 text-slate-400"/>}</div>
                    </div>
                    {isExpanded && (
                        <div className="mt-6 pt-4 border-t border-white/5 animate-fade-in">
                            <div className="space-y-2 mb-4">
                                {item.links && item.links.map((link, idx) => (
                                    <div key={idx} className="flex justify-between items-center bg-black/20 p-3 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                                        <a href={link.url} target="_blank" className="text-blue-400 hover:text-white hover:underline font-bold flex items-center gap-2"><Icons.Link className="w-3 h-3"/> {link.title}</a>
                                        <button onClick={() => removeLink(idx)} className="text-slate-600 hover:text-red-500 transition-colors"><Icons.Trash2 className="w-4 h-4"/></button>
                                    </div>
                                ))}
                                {(!item.links || item.links.length === 0) && <div className="text-slate-600 text-sm italic">No links yet. Add archives here.</div>}
                            </div>
                            <div className="flex gap-3 bg-slate-900/50 p-2 rounded-xl border border-white/10">
                                <input type="text" placeholder="Description" className="flex-1 bg-transparent text-sm text-white px-2 focus:outline-none" value={newLinkTitle} onChange={e => setNewLinkTitle(e.target.value)} />
                                <div className="w-px bg-white/10"></div>
                                <input type="text" placeholder="URL" className="flex-1 bg-transparent text-sm text-white px-2 focus:outline-none" value={newLinkUrl} onChange={e => setNewLinkUrl(e.target.value)} />
                                <button onClick={addLink} className="bg-blue-600 text-white px-4 py-1 rounded-lg font-bold hover:bg-blue-500 text-xs">ADD</button>
                            </div>
                            <button onClick={() => onDelete(item.id)} className="w-full mt-4 text-xs text-red-400/50 hover:text-red-400 hover:bg-red-900/20 py-2 rounded-lg transition-all">Delete Entry</button>
                        </div>
                    )}
                </div> 
            );
        };
        const DatabaseBoard = ({ years, players, onAddItem, onUpdateItem, onDeleteItem }) => {
            const [activeSubTab, setActiveSubTab] = useState('years'); const [newItemName, setNewItemName] = useState('');
            const handleAdd = (e) => { e.preventDefault(); if (!newItemName.trim()) return; onAddItem({ name: newItemName, type: activeSubTab === 'years' ? 'year' : 'player', links: [] }); setNewItemName(''); };
            const currentList = activeSubTab === 'years' ? years : players;
            return ( 
                <div className="space-y-8 animate-fade-in">
                    <div className="flex justify-between items-center glass-panel p-2 rounded-2xl mb-4 w-full">
                        <button onClick={() => setActiveSubTab('years')} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all flex justify-center items-center gap-2 ${activeSubTab === 'years' ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-white'}`}><Icons.Calendar className="w-4 h-4"/> Historical Years</button>
                        <button onClick={() => setActiveSubTab('players')} className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all flex justify-center items-center gap-2 ${activeSubTab === 'players' ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-white'}`}><Icons.Users className="w-4 h-4"/> Player Archive</button>
                    </div>
                    <div className="glass-panel p-6 rounded-3xl border border-slate-700">
                        <form onSubmit={handleAdd} className="flex gap-4">
                            <input type="text" placeholder={activeSubTab === 'years' ? "Enter Year (e.g. 1986)" : "Enter Player Name"} className="flex-1 bg-slate-900/50 border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-blue-500 text-lg font-bold" value={newItemName} onChange={e => setNewItemName(e.target.value)} />
                            <button type="submit" className="bg-blue-600 hover:bg-blue-500 text-white font-bold px-8 py-3 rounded-xl shadow-lg text-xl"><Icons.Plus className="w-6 h-6"/></button>
                        </form>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {currentList.map(item => (<DatabaseItem key={item.id} item={item} onUpdate={onUpdateItem} onDelete={onDeleteItem} />))}
                        {currentList.length === 0 && (<div className="col-span-full text-center py-12"><div className="text-slate-600 text-lg italic">The archives are empty. Start building history.</div></div>)}
                    </div>
                </div> 
            );
        }

        const NewsBoard = ({ news, onAdd, onDelete }) => {
            const [filterMonth, setFilterMonth] = useState('All');
            const [filterWeek, setFilterWeek] = useState('All');
            const [newItem, setNewItem] = useState({ title: '', url: '', date: new Date().toISOString().split('T')[0], type: 'Article' });

            const handleAdd = (e) => {
                e.preventDefault();
                onAdd(newItem);
                setNewItem({ title: '', url: '', date: new Date().toISOString().split('T')[0], type: 'Article' });
            };

            const getMonthName = (dateStr) => { if(!dateStr) return ''; const d = new Date(dateStr + 'T12:00:00'); return d.toLocaleString('default', { month: 'long' }); };
            const getDay = (dateStr) => { if(!dateStr) return 0; const d = new Date(dateStr + 'T12:00:00'); return d.getDate(); };

            const filteredNews = news.filter(item => {
                const monthName = getMonthName(item.date);
                const day = getDay(item.date);
                const matchMonth = filterMonth === 'All' || monthName === filterMonth;
                
                let matchWeek = true;
                if (filterWeek !== 'All') {
                    if (filterWeek === 'Week 1') matchWeek = day >= 1 && day <= 7;
                    else if (filterWeek === 'Week 2') matchWeek = day >= 8 && day <= 14;
                    else if (filterWeek === 'Week 3') matchWeek = day >= 15 && day <= 21;
                    else if (filterWeek === 'Week 4') matchWeek = day >= 22 && day <= 28;
                    else if (filterWeek === 'Week 5') matchWeek = day >= 29;
                }
                return matchMonth && matchWeek;
            });

            const monthsList = ['All', 'November', 'December', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'];
            const weeksList = ['All', 'Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'];

            const typeIcons = { 'Article': <Icons.FileText className="w-4 h-4"/>, 'Video': <Icons.Play className="w-4 h-4"/>, 'Tweet': <Icons.MessageSquare className="w-4 h-4"/>, 'Blog': <Icons.Edit2 className="w-4 h-4"/> };
            const typeColors = { 'Article': 'text-blue-400 bg-blue-900/20 border-blue-500/30', 'Video': 'text-red-400 bg-red-900/20 border-red-500/30', 'Tweet': 'text-sky-400 bg-sky-900/20 border-sky-500/30', 'Blog': 'text-orange-400 bg-orange-900/20 border-orange-500/30' };

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="glass-panel p-6 rounded-3xl border border-slate-700">
                        <h3 className="text-lg font-black text-white mb-4">Post News</h3>
                        <form onSubmit={handleAdd} className="flex gap-3 items-end">
                            <div className="w-32 space-y-1">
                                <label className="text-[10px] uppercase font-bold text-slate-500">Date</label>
                                <input type="date" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newItem.date} onChange={e => setNewItem({...newItem, date: e.target.value})} required />
                            </div>
                            <div className="w-32 space-y-1">
                                <label className="text-[10px] uppercase font-bold text-slate-500">Type</label>
                                <select className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newItem.type} onChange={e => setNewItem({...newItem, type: e.target.value})}>
                                    <option value="Article">Article</option>
                                    <option value="Video">Video</option>
                                    <option value="Tweet">Tweet</option>
                                    <option value="Blog">Blog</option>
                                </select>
                            </div>
                            <div className="flex-[2] space-y-1">
                                <label className="text-[10px] uppercase font-bold text-slate-500">Headline</label>
                                <input type="text" placeholder="News Headline..." className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newItem.title} onChange={e => setNewItem({...newItem, title: e.target.value})} required />
                            </div>
                            <div className="flex-[2] space-y-1">
                                <label className="text-[10px] uppercase font-bold text-slate-500">Link URL</label>
                                <input type="text" placeholder="https://..." className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newItem.url} onChange={e => setNewItem({...newItem, url: e.target.value})} required />
                            </div>
                            <button type="submit" className="bg-blue-600 hover:bg-blue-500 text-white font-bold p-3 rounded-xl shadow-lg h-[50px] w-[50px] flex items-center justify-center"><Icons.Plus className="w-6 h-6"/></button>
                        </form>
                    </div>

                    <div className="space-y-2">
                        <div className="flex gap-2 overflow-x-auto custom-scrollbar pb-2">
                            {monthsList.map(month => (
                                <button key={month} onClick={() => setFilterMonth(month)} className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border border-white/5 ${filterMonth === month ? 'bg-blue-600 text-white' : 'bg-slate-900/50 text-slate-400 hover:text-white hover:bg-white/10'}`}>{month}</button>
                            ))}
                        </div>
                        <div className="flex gap-2 overflow-x-auto custom-scrollbar pb-2">
                            {weeksList.map(week => (
                                <button key={week} onClick={() => setFilterWeek(week)} className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border border-white/5 ${filterWeek === week ? 'bg-slate-700 text-white' : 'bg-slate-900/30 text-slate-500 hover:text-white hover:bg-white/10'}`}>{week}</button>
                            ))}
                        </div>
                    </div>

                    <div className="grid gap-3">
                        {filteredNews.map(n => (
                            <div key={n.id} className={`glass-panel p-4 rounded-2xl border transition-all group flex items-center justify-between ${n.type === 'Live Feed' ? 'border-green-500/30 bg-green-900/5' : 'border-white/10 hover:bg-white/5'}`}>
                                <div className="flex items-center gap-4 overflow-hidden">
                                    <div className={`p-3 rounded-xl border ${n.type === 'Live Feed' ? 'text-green-400 border-green-500/50' : typeColors[n.type] || 'text-slate-400 border-slate-500'}`}>
                                        {n.type === 'Live Feed' ? <Icons.Radio className="w-4 h-4 animate-pulse"/> : typeIcons[n.type]}
                                    </div>
                                    <div className="min-w-0">
                                        <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-0.5">
                                            {n.date} ‚Ä¢ {n.type} {n.source && `‚Ä¢ ${n.source}`}
                                        </div>
                                        <a href={n.url} target="_blank" className="text-white font-bold text-lg hover:text-blue-400 transition-colors truncate block">{n.title}</a>
                                    </div>
                                </div>
                                {n.type !== 'Live Feed' && (
                                    <button onClick={() => onDelete(n.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4"/></button>
                                )}
                            </div>
                        ))}
                        {filteredNews.length === 0 && <div className="text-center text-slate-500 py-12">No news found for this period.</div>}
                    </div>
                </div>
            );
        };

        const BlogBoard = ({ posts, onAdd, onDelete, currentUser }) => {
            const [newPost, setNewPost] = useState({ title: '', content: '', imageUrl: '', date: new Date().toISOString().split('T')[0] });
            const [isFormOpen, setIsFormOpen] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                if(!currentUser) return;
                
                // Add author info to the new post
                onAdd({
                    ...newPost,
                    authorId: currentUser.uid,
                    authorName: currentUser.displayName || currentUser.email.split('@')[0],
                    authorPhoto: currentUser.photoURL
                });
                
                setNewPost({ title: '', content: '', imageUrl: '', date: new Date().toISOString().split('T')[0] });
                setIsFormOpen(false);
            };

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="flex justify-between items-center">
                        <h3 className="text-2xl font-black text-white italic">MetsSky <span className="text-purple-400">Blog</span></h3>
                        {currentUser && (
                            <button onClick={() => setIsFormOpen(!isFormOpen)} className="bg-purple-600 hover:bg-purple-500 text-white px-6 py-2 rounded-xl font-bold transition-all shadow-lg flex items-center gap-2">
                                {isFormOpen ? <Icons.X className="w-4 h-4"/> : <Icons.Edit2 className="w-4 h-4"/>}
                                {isFormOpen ? 'Close Editor' : 'Write Post'}
                            </button>
                        )}
                    </div>

                    {isFormOpen && currentUser && (
                        <div className="glass-panel p-6 rounded-3xl border border-purple-500/30 mb-8">
                            <h4 className="text-lg font-bold text-white mb-4">New Blog Post</h4>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <label className="text-[10px] uppercase font-bold text-slate-500">Headline</label>
                                        <input type="text" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-purple-500 font-bold" value={newPost.title} onChange={e => setNewPost({...newPost, title: e.target.value})} required />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] uppercase font-bold text-slate-500">Date</label>
                                        <input type="date" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-purple-500" value={newPost.date} onChange={e => setNewPost({...newPost, date: e.target.value})} required />
                                    </div>
                                </div>
                                <div className="space-y-1">
                                    <label className="text-[10px] uppercase font-bold text-slate-500">Header Image URL</label>
                                    <input type="text" placeholder="https://..." className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-purple-500" value={newPost.imageUrl} onChange={e => setNewPost({...newPost, imageUrl: e.target.value})} />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-[10px] uppercase font-bold text-slate-500">Content</label>
                                    <textarea className="w-full h-48 bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-purple-500" placeholder="Write your article here..." value={newPost.content} onChange={e => setNewPost({...newPost, content: e.target.value})} required></textarea>
                                </div>
                                <div className="flex justify-end">
                                    <button type="submit" className="bg-purple-600 hover:bg-purple-500 text-white font-bold px-8 py-3 rounded-xl shadow-lg">Publish Post</button>
                                </div>
                            </form>
                        </div>
                    )}

                    <div className="grid grid-cols-1 gap-8">
                        {posts.map(post => (
                            <div key={post.id} className="glass-panel rounded-3xl overflow-hidden border border-white/5 hover:border-purple-500/30 transition-all group">
                                {post.imageUrl && (
                                    <div className="h-64 w-full overflow-hidden relative">
                                        <img src={post.imageUrl} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-700" alt="Blog Header" />
                                        <div className="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent"></div>
                                    </div>
                                )}
                                <div className="p-8 relative">
                                    <div className="flex justify-between items-start mb-4">
                                        <div className="text-xs font-bold text-purple-400 uppercase tracking-widest flex items-center gap-2">
                                            <Icons.Calendar className="w-3 h-3"/> {post.date}
                                        </div>
                                        {(currentUser && currentUser.uid === post.authorId) && (
                                            <button onClick={() => onDelete(post.id)} className="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.Trash2 className="w-4 h-4"/></button>
                                        )}
                                    </div>
                                    <h2 className="text-3xl font-black text-white mb-4 leading-tight">{post.title}</h2>
                                    <div className="text-slate-300 leading-relaxed whitespace-pre-wrap font-serif text-lg mb-6">{post.content}</div>
                                    
                                    <div className="border-t border-white/5 pt-4 mb-4 flex items-center gap-2">
                                        {post.authorPhoto ? <img src={post.authorPhoto} className="w-6 h-6 rounded-full" /> : <div className="w-6 h-6 rounded-full bg-slate-700"></div>}
                                        <span className="text-xs font-bold text-purple-400">By {post.authorName || 'Anonymous Fan'}</span>
                                    </div>

                                    <CommentSection parentId={post.id} currentUser={currentUser} />
                                </div>
                            </div>
                        ))}
                        {posts.length === 0 && <div className="text-center text-slate-500 py-12 italic">No blog posts yet. Start writing!</div>}
                    </div>
                </div>
            );
        };

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [rosterMode, setRosterMode] = useState('squad'); 
            const [scheduleMode, setScheduleMode] = useState('Regular'); 
            const [filterMonth, setFilterMonth] = useState('All'); 
            const [currentUser, setCurrentUser] = useState(null);

            const [currentSeasonYear, setCurrentSeasonYear] = useState('2025'); 
            const [availableSeasons, setAvailableSeasons] = useState(['2025', '2026']); 
            const [games, setGames] = useState([]);
            const [schedule2026, setSchedule2026] = useState([]);
            const [rants, setRants] = useState([]);
            const [players, setPlayers] = useState([]);
            const [squad, setSquad] = useState([]); 
            const [links, setLinks] = useState([]);
            const [transactions, setTransactions] = useState([]);
            const [channels, setChannels] = useState([]);
            const [dbYears, setDbYears] = useState([]); 
            const [dbPlayers, setDbPlayers] = useState([]); 
            const [news, setNews] = useState([]); 
            const [blogPosts, setBlogPosts] = useState([]); 
            const [isOnline, setIsOnline] = useState(false); 
            const [loading, setLoading] = useState(true);
            
            // Auth State
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [newUsername, setNewUsername] = useState(''); // For sign up
            const [isSignUp, setIsSignUp] = useState(false);
            const [authError, setAuthError] = useState('');
            
            // Inputs
            const [newScheduleItem, setNewScheduleItem] = useState({ date: '', opponent: '', location: 'Home', time: '', gameType: 'Regular', result: 'Pending', scoreUs: '', scoreThem: '', links: [], notes: '' });
            const [newRant, setNewRant] = useState({ topic: '', content: '', mood: 'Neutral' });
            const [newPlayer, setNewPlayer] = useState({ name: '', number: '', status: 'Hot', notes: '' });
            const [newSquadMember, setNewSquadMember] = useState({ name: '', number: '', position: 'Pitcher', throws: 'R', status: 'Active (30-Man)', links: [] });
            const [newLink, setNewLink] = useState({ title: '', url: '' });
            const [newTrans, setNewTrans] = useState({ type: 'Signed', playerId: '', player: '', fromTeam: '', toTeam: 'Mets', notes: '' });

            // Auth & Data
            useEffect(() => {
                const init = async () => {
                    auth.onAuthStateChanged(user => {
                        if (user) {
                            setCurrentUser(user);
                        } else {
                            setCurrentUser(null);
                        }
                    });
                    
                    const checkOnline = () => setIsOnline(navigator.onLine);
                    window.addEventListener('online', checkOnline);
                    window.addEventListener('offline', checkOnline);
                    checkOnline(); 
                    
                    const unsubSchedule = db.collection('mets_schedule_2026').orderBy('date', 'asc').onSnapshot(s => {
                        const allGames = s.docs.map(d => ({ id: d.id, ...d.data() }));
                        setSchedule2026(allGames);
                    });

                    const unsubRants = db.collection('mets_rants').orderBy('createdAt', 'desc').onSnapshot(s => setRants(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubPlayers = db.collection('mets_roster').orderBy('createdAt', 'desc').onSnapshot(s => setPlayers(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubSquad = db.collection('mets_squad').orderBy('name', 'asc').onSnapshot(s => setSquad(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubLinks = db.collection('mets_links').orderBy('createdAt', 'desc').onSnapshot(s => setLinks(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubChannels = db.collection('mets_channels').orderBy('createdAt', 'desc').onSnapshot(s => setChannels(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubTrans = db.collection('mets_transactions').orderBy('createdAt', 'desc').onSnapshot(s => setTransactions(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubBlog = db.collection('mets_blog').orderBy('date', 'desc').onSnapshot(s => setBlogPosts(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    
                    const unsubDbYears = db.collection('mets_db_years').orderBy('name', 'desc').onSnapshot(s => setDbYears(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                    const unsubDbPlayers = db.collection('mets_db_players').orderBy('name', 'asc').onSnapshot(s => {
                        setDbPlayers(s.docs.map(d => ({ id: d.id, ...d.data() })));
                        setLoading(false);
                    });

                    // RSS Feeds for News
                    const unsubNews = db.collection('mets_news').orderBy('date', 'desc').onSnapshot(async (s) => {
                        const manualNews = s.docs.map(d => ({ id: d.id, ...d.data(), source: 'Manual' }));
                        
                        try {
                            const rssUrls = [
                                'https://api.rss2json.com/v1/api.json?rss_url=https://sports.yahoo.com/mlb/teams/nym/rss.xml',
                                'https://api.rss2json.com/v1/api.json?rss_url=https://www.mlb.com/mets/feeds/news/rss.xml',
                                'https://api.rss2json.com/v1/api.json?rss_url=https://nypost.com/sports/mets/feed/',
                                'https://api.rss2json.com/v1/api.json?rss_url=https://metsmerizedonline.com/feed/',
                                'https://api.rss2json.com/v1/api.json?rss_url=https://www.amazinavenue.com/rss/current.xml',
                                'https://api.rss2json.com/v1/api.json?rss_url=https://risingapple.com/feed/'
                            ];

                            const responses = await Promise.all(rssUrls.map(url => fetch(url).then(res => res.json())));
                            
                            let liveArticles = [];
                            responses.forEach(feed => {
                                if(feed.status === 'ok') {
                                    const items = feed.items.map(item => {
                                        // FIX: Properly parse the RSS date
                                        const d = new Date(item.pubDate);
                                        const validDate = !isNaN(d) ? d.toISOString().split('T')[0] : new Date().toISOString().split('T')[0];
                                        
                                        return {
                                            id: item.guid || item.link,
                                            title: item.title,
                                            url: item.link,
                                            date: validDate, 
                                            type: 'Live Feed',
                                            source: feed.feed.title 
                                        };
                                    });
                                    liveArticles = [...liveArticles, ...items];
                                }
                            });

                            const combined = [...manualNews, ...liveArticles].reduce((acc, current) => {
                                const x = acc.find(item => item.url === current.url);
                                if (!x) { return acc.concat([current]); } else { return acc; }
                            }, []).sort((a, b) => new Date(b.date) - new Date(a.date));

                            setNews(combined);
                        } catch (err) {
                            console.error("Error fetching RSS feeds:", err);
                            setNews(manualNews);
                        }
                    }); 
                    
                    return () => { unsubSchedule(); unsubRants(); unsubPlayers(); unsubSquad(); unsubLinks(); unsubTrans(); unsubChannels(); unsubDbYears(); unsubDbPlayers(); unsubNews(); unsubBlog(); window.removeEventListener('online', checkOnline); window.removeEventListener('offline', checkOnline); };
                };
                init();
            }, []);

            // --- AUTOMATION ACTIONS ---
            const syncSchedule = async () => {
                if(!confirm("Fetch live schedule from MLB (and check for new recaps)?")) return;
                try {
                    const response = await fetch(`https://statsapi.mlb.com/api/v1/schedule?sportId=1&teamId=121&season=${currentSeasonYear}&hydrate=team,game(content(editorial(recap)))`);
                    const data = await response.json();
                    
                    const batch = db.batch();
                    data.dates.forEach(d => {
                        const game = d.games[0];
                        if(!game) return;
                        const isHome = game.teams.home.team.id === 121;
                        const opponent = isHome ? game.teams.away.team.name : game.teams.home.team.name;
                        const hasResult = game.status.statusCode === 'F' || game.status.statusCode === 'O'; 
                        
                        let result = 'Pending';
                        if(hasResult) {
                            const myScore = isHome ? game.teams.home.score : game.teams.away.score;
                            const oppScore = isHome ? game.teams.away.score : game.teams.home.score;
                            result = myScore > oppScore ? 'W' : 'L';
                        }

                        let recapLink = null;
                        if(game.content && game.content.editorial && game.content.editorial.recap && game.content.editorial.recap.mlb) {
                            const slug = game.content.editorial.recap.mlb.slug;
                            if(slug) {
                                recapLink = { title: 'Game Recap', url: 'https://www.mlb.com/news/' + slug };
                            }
                        }
                        
                        if(!recapLink && hasResult) {
                            recapLink = { title: 'MLB Gameday', url: `https://www.mlb.com/gameday/${game.gamePk}` };
                        }

                        const docRef = db.collection('mets_schedule_2026').doc(String(game.gamePk));
                        
                        const updateData = {
                            date: d.date,
                            time: new Date(game.gameDate).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                            opponent: opponent,
                            location: isHome ? 'Home' : 'Away',
                            gameType: game.gameType === 'S' ? 'Spring' : 'Regular',
                            season: currentSeasonYear,
                            scoreUs: hasResult ? (isHome ? game.teams.home.score : game.teams.away.score) : '',
                            scoreThem: hasResult ? (isHome ? game.teams.away.score : game.teams.home.score) : '',
                            result: result,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        if(recapLink) {
                            updateData.links = firebase.firestore.FieldValue.arrayUnion(recapLink);
                        }

                        batch.set(docRef, updateData, { merge: true });
                    });
                    await batch.commit();
                    alert("Schedule & Recaps Synced!");
                } catch(e) { console.error(e); alert("Sync failed."); }
            };

            const syncRoster = async () => {
                if(!confirm("Fetch live 40-man roster from MLB?")) return;
                try {
                    const res = await fetch('https://statsapi.mlb.com/api/v1/teams/121/roster?rosterType=40Man');
                    const data = await res.json();
                    
                    const batch = db.batch();
                    const posMap = { 'Pitcher': 'Pitcher', 'Catcher': 'Catcher', 'First Base': 'Infield', 'Second Base': 'Infield', 'Third Base': 'Infield', 'Shortstop': 'Infield', 'Outfielder': 'Outfield', 'Designated Hitter': 'DH' };
                    
                    data.roster.forEach(p => {
                        const status = p.status.code === 'A' ? 'Active (30-Man)' : p.status.code.includes('D') ? 'Injured List (IL)' : '40-Man / Minors';
                        const position = posMap[p.position.name] || 'Infield';
                        const docRef = db.collection('mets_squad').doc(String(p.person.id));
                        
                        batch.set(docRef, {
                            name: p.person.fullName,
                            number: p.jerseyNumber,
                            position: position,
                            status: status,
                            throws: 'R', 
                            mlbId: p.person.id,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        }, { merge: true });
                    });
                    await batch.commit();
                    alert("Roster Synced with MLB!");
                } catch(e) { console.error(e); alert("Sync failed."); }
            };

            const syncTransactions = async () => {
                if(!confirm("Fetch official transactions from MLB (Last 90 days)?")) return;
                try {
                    const d = new Date();
                    d.setDate(d.getDate() - 90);
                    const startDate = d.toISOString().split('T')[0];
                    const endDate = new Date().toISOString().split('T')[0];

                    const res = await fetch(`https://statsapi.mlb.com/api/v1/transactions?teamId=121&startDate=${startDate}&endDate=${endDate}`);
                    const data = await res.json();
                    
                    const batch = db.batch();
                    
                    data.transactions.forEach(t => {
                        let type = 'Signed';
                        const desc = t.description.toLowerCase();
                        
                        if (desc.includes('trade')) {
                            if (desc.includes('acquired')) type = 'Trade (Arrival)';
                            else if (desc.includes('traded to')) type = 'Trade (Departure)';
                            else type = 'Trade (Arrival)';
                        }
                        if (desc.includes('assigned') || desc.includes('optioned')) type = 'Optioned';
                        if (desc.includes('designated for assignment')) type = 'DFA';
                        if (desc.includes('placed on') && desc.includes('injured')) type = 'IL';
                        if (desc.includes('claimed off waivers')) type = 'Waivers (Claimed)';
                        if (desc.includes('lost') && desc.includes('waivers')) type = 'Waivers (Lost)';
                        if (desc.includes('elected free agency')) type = 'Lost';
                        
                        const docRef = db.collection('mets_transactions').doc(String(t.id)); 
                        
                        batch.set(docRef, {
                            type: type,
                            player: t.person ? t.person.fullName : 'Team Move',
                            fromTeam: 'MLB Wire',
                            toTeam: 'Mets',
                            notes: t.description,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        }, { merge: true });
                    });
                    
                    await batch.commit();
                    alert("Transactions Synced!");
                } catch(e) { console.error(e); alert("Sync failed."); }
            };

            // --- MANUAL ACTIONS ---
            const addScheduleItem = async (e) => { e.preventDefault(); await db.collection('mets_schedule_2026').add({ ...newScheduleItem, season: currentSeasonYear }); setNewScheduleItem({ date: '', opponent: '', location: 'Home', time: '', gameType: 'Regular', result: 'Pending', scoreUs: '', scoreThem: '', links: [], notes: '' }); };
            const updateScheduleItem = (id, data) => db.collection('mets_schedule_2026').doc(id).update(data);
            const deleteScheduleItem = (id) => { if(confirm("Delete scheduled game?")) db.collection('mets_schedule_2026').doc(id).delete(); };

            const handleEmailAuth = async (e) => {
                e.preventDefault();
                setAuthError('');
                try {
                    if(isSignUp) {
                        const cred = await auth.createUserWithEmailAndPassword(email, password);
                        await cred.user.updateProfile({ displayName: newUsername || email.split('@')[0] });
                        setCurrentUser(Object.assign({}, cred.user, { displayName: newUsername || email.split('@')[0] }));
                    } else {
                        await auth.signInWithEmailAndPassword(email, password);
                    }
                } catch (err) {
                    setAuthError(err.message.replace("Firebase: ", ""));
                }
            };
            
            const handleGoogleLogin = async () => {
                setAuthError('');
                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    await auth.signInWithPopup(provider);
                } catch (err) {
                    setAuthError(err.message.replace("Firebase: ", ""));
                }
            };

            const handleLogout = () => {
                auth.signOut();
                setEmail('');
                setPassword('');
                setNewUsername('');
            };

            const addRant = async (e) => { 
                e.preventDefault(); 
                if (!currentUser) return;

                await db.collection('mets_rants').add({ 
                    ...newRant, 
                    date: new Date().toLocaleDateString(), 
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    authorId: currentUser.uid,
                    authorName: currentUser.displayName || currentUser.email.split('@')[0],
                    authorPhoto: currentUser.photoURL
                }); 
                setNewRant({ topic: '', content: '', mood: 'Neutral' }); 
            };
            
            const deleteRant = (id) => db.collection('mets_rants').doc(id).delete();

            const addBlogPost = async (data) => { await db.collection('mets_blog').add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); };
            const deleteBlogPost = (id) => { if(confirm("Delete blog post?")) db.collection('mets_blog').doc(id).delete(); };

            const addPlayer = async (e) => { e.preventDefault(); await db.collection('mets_roster').add({ ...newPlayer, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); setNewPlayer({ name: '', number: '', status: 'Hot', notes: '' }); };
            const deletePlayer = (id) => db.collection('mets_roster').doc(id).delete();

            const addSquadMember = async (e) => { e.preventDefault(); await db.collection('mets_squad').add({ ...newSquadMember, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); setNewSquadMember({ name: '', number: '', position: 'Pitcher', throws: 'R', status: 'Active (30-Man)', links: [] }); };
            const updateSquadMember = (id, data) => db.collection('mets_squad').doc(id).update(data); 
            const deleteSquadMember = (id) => { if(confirm("Remove player from squad?")) db.collection('mets_squad').doc(id).delete(); };

            const addLink = async (e) => { e.preventDefault(); await db.collection('mets_links').add({ ...newLink, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); setNewLink({ title: '', url: '' }); };
            const deleteLink = (id) => db.collection('mets_links').doc(id).delete();

            const addTrans = async (e) => { 
                e.preventDefault(); 
                let playerName = newTrans.player;
                if (['Lost', 'DFA', 'Trade (Departure)', 'Waivers (Lost)', 'Optioned'].includes(newTrans.type) && newTrans.playerId) {
                    const selectedPlayer = squad.find(p => p.id === newTrans.playerId);
                    if (selectedPlayer) { playerName = selectedPlayer.name; const newStatus = newTrans.type === 'Optioned' ? '40-Man / Minors' : 'Archived / Former Met'; await db.collection('mets_squad').doc(newTrans.playerId).update({ status: newStatus }); }
                } else if (newTrans.type === 'IL' && newTrans.playerId) { const selectedPlayer = squad.find(p => p.id === newTrans.playerId); if (selectedPlayer) { playerName = selectedPlayer.name; await db.collection('mets_squad').doc(newTrans.playerId).update({ status: 'Injured List (IL)' }); }
                } else if (newTrans.type === 'Promoted' && newTrans.playerId) { const selectedPlayer = squad.find(p => p.id === newTrans.playerId); if (selectedPlayer) { playerName = selectedPlayer.name; await db.collection('mets_squad').doc(newTrans.playerId).update({ status: 'Active (30-Man)' }); } }
                
                await db.collection('mets_transactions').add({ ...newTrans, player: playerName, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); 
                setNewTrans({ type: 'Signed', playerId: '', player: '', fromTeam: '', toTeam: 'Mets', notes: '' }); 
            };
            const deleteTrans = (id) => db.collection('mets_transactions').doc(id).delete();
            
            const addChannel = async (data) => { await db.collection('mets_channels').add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); };
            const deleteChannel = (id) => { if(confirm("Remove channel?")) db.collection('mets_channels').doc(id).delete(); };

            const addDatabaseItem = async (data) => { const collection = data.type === 'year' ? 'mets_db_years' : 'mets_db_players'; await db.collection(collection).add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); };
            const updateDatabaseItem = (id, data) => { const isYear = dbYears.find(y => y.id === id); const collection = isYear ? 'mets_db_years' : 'mets_db_players'; db.collection(collection).doc(id).update(data); };
            const deleteDatabaseItem = (id) => { const isYear = dbYears.find(y => y.id === id); const collection = isYear ? 'mets_db_years' : 'mets_db_players'; if(confirm("Delete from archives?")) db.collection(collection).doc(id).delete(); }

            const addNews = async (data) => { await db.collection('mets_news').add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); };
            const deleteNews = (id) => { if(confirm("Delete news item?")) db.collection('mets_news').doc(id).delete(); };

            const initializeNextSeason = () => { const nextYear = (parseInt(currentSeasonYear) + 1).toString(); if (!availableSeasons.includes(nextYear)) { setAvailableSeasons([...availableSeasons, nextYear].sort()); } setCurrentSeasonYear(nextYear); };
            const wins = schedule2026.filter(g => g.result === 'W' && (g.gameType || 'Regular') === 'Regular' && (g.season || '2026') === currentSeasonYear).length;
            const losses = schedule2026.filter(g => g.result === 'L' && (g.gameType || 'Regular') === 'Regular' && (g.season || '2026') === currentSeasonYear).length;

            const getMonthName = (dateStr) => {
                if(!dateStr) return '';
                const date = new Date(dateStr + 'T12:00:00'); 
                return date.toLocaleString('default', { month: 'long' });
            };

            const filteredGames = schedule2026.filter(g => {
                const matchType = (g.gameType || 'Regular') === scheduleMode;
                const matchYear = (g.season || '2026') === currentSeasonYear;
                const matchMonth = filterMonth === 'All' || getMonthName(g.date) === filterMonth;
                return matchType && matchYear && matchMonth;
            });

            const monthsList = ['All', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November'];

            if (loading) return <div className="min-h-screen flex items-center justify-center text-orange-500 font-black text-2xl bg-slate-900">LOADING CITI FIELD...</div>;

            return (
                <div className="min-h-screen pb-10">
                    <div className="glass-panel sticky top-0 z-50 border-b border-white/10 mb-8">
                        <div className="max-w-5xl mx-auto px-6 h-24 flex justify-between items-center">
                            <div className="flex items-center gap-4 group cursor-pointer" onClick={() => setActiveTab('home')}>
                                <div className="bg-gradient-to-br from-orange-500 to-red-600 p-3 rounded-2xl shadow-lg shadow-orange-500/30 group-hover:scale-110 transition-transform">
                                    <span className="text-3xl">‚öæ</span>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black text-white tracking-tight italic">Mets<span className="text-blue-500">Sky</span></h1>
                                    <p className="text-xs font-bold text-slate-400 uppercase tracking-[0.2em]">The New York Frame of Mind</p>
                                </div>
                            </div>
                            <div className="flex gap-2 bg-black/20 p-1.5 rounded-xl border border-white/5 overflow-x-auto custom-scrollbar">
                                {['home', 'news', 'blog', 'media', 'schedule', 'roster', 'moves', 'database', 'rants', 'links'].map(tab => (
                                    <button 
                                        key={tab}
                                        onClick={() => setActiveTab(tab)} 
                                        className={`px-5 py-2.5 rounded-lg font-bold text-sm transition-all flex items-center gap-2 ${activeTab === tab ? (tab === 'blog' ? 'bg-purple-600' : 'bg-blue-600') + ' text-white shadow-lg' : 'text-slate-400 hover:text-white hover:bg-white/5'}`}
                                    >
                                        {tab === 'home' && <Icons.Home className="w-4 h-4"/>}
                                        {tab === 'news' && <Icons.Newspaper className="w-4 h-4"/>}
                                        {tab === 'blog' && <Icons.BookOpen className="w-4 h-4"/>}
                                        {tab === 'media' && <Icons.Tv className="w-4 h-4"/>}
                                        {tab === 'database' && <Icons.Database className="w-4 h-4"/>}
                                        {tab === 'schedule' ? '2026 Season' : tab === 'moves' ? 'Transactions' : tab === 'news' ? 'Wire' : tab === 'rants' ? 'Fan Zone' : tab.charAt(0).toUpperCase() + tab.slice(1)}
                                    </button>
                                ))}
                                <div className="ml-4 flex items-center gap-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest border-l border-slate-700 pl-4"><div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-green-500 pulse-dot' : 'bg-red-500'}`}></div>{isOnline ? "LIVE" : "OFFLINE"}</div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-5xl mx-auto px-6">
                        {activeTab === 'home' && (
                            <div className="animate-fade-in space-y-10">
                                
                                <CountdownTicket />

                                <div className="relative h-96 rounded-3xl overflow-hidden flex items-center justify-center bg-gradient-to-br from-blue-900 to-slate-900 border border-white/10 shadow-2xl group">
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                                    <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-transparent via-blue-900/20 to-slate-900/90"></div>
                                    <div className="absolute -bottom-20 -right-20 w-96 h-96 bg-orange-500/20 rounded-full blur-3xl group-hover:bg-orange-500/30 transition-all duration-1000"></div>
                                    <div className="absolute -top-20 -left-20 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl group-hover:bg-blue-500/30 transition-all duration-1000"></div>
                                    
                                    <div className="relative z-10 text-center px-4">
                                        <h1 className="text-6xl md:text-9xl font-black text-white tracking-tighter drop-shadow-2xl scale-95 group-hover:scale-100 transition-transform duration-500">
                                            LET'S GO <span className="text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-500 text-glow">METS</span>
                                        </h1>
                                        <p className="text-blue-300 text-xl md:text-2xl font-black tracking-[0.5em] mt-6 uppercase opacity-80">The Dynasty Starts Here</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                                    <button onClick={() => setActiveTab('news')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-sky-500/50 md:col-span-2">
                                        <div className="p-4 bg-sky-600 text-white rounded-2xl group-hover:scale-110 transition-transform shadow-lg shadow-sky-500/20 flex gap-2">
                                            <Icons.Newspaper className="w-8 h-8"/>
                                            <Icons.Radio className="w-8 h-8 text-yellow-400"/>
                                        </div>
                                        <div className="font-black text-white text-2xl uppercase tracking-wide">News Wire</div>
                                        <div className="text-xs text-slate-400 font-bold">Blogs ‚Ä¢ Videos ‚Ä¢ Tweets</div>
                                    </button>
                                    
                                    <button onClick={() => setActiveTab('blog')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-purple-500/50 md:col-span-2">
                                        <div className="p-4 bg-purple-500/20 rounded-2xl group-hover:scale-110 transition-transform shadow-lg shadow-purple-500/20">
                                            <Icons.BookOpen className="w-8 h-8 text-purple-400"/>
                                        </div>
                                        <div className="font-black text-white text-2xl uppercase tracking-wide">MetsSky Blog</div>
                                        <div className="text-xs text-slate-400 font-bold">Long Form ‚Ä¢ Editorials</div>
                                    </button>

                                    <button onClick={() => setActiveTab('media')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-yellow-500/50">
                                        <div className="p-4 bg-yellow-500/20 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Tv className="w-8 h-8 text-yellow-400"/></div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Media</div>
                                        <div className="text-xs text-slate-400 font-bold">Video Wall ‚Ä¢ Channels</div>
                                    </button>

                                    <button onClick={() => setActiveTab('schedule')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-blue-500/50">
                                        <div className="p-4 bg-blue-500/20 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Calendar className="w-8 h-8 text-blue-400"/></div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Season Log</div>
                                    </button>

                                    <button onClick={() => setActiveTab('roster')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-orange-500/50">
                                        <div className="p-4 bg-orange-500/20 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Users className="w-8 h-8 text-orange-400"/></div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Roster</div>
                                    </button>

                                    <button onClick={() => setActiveTab('moves')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-green-500/50">
                                        <div className="p-4 bg-green-500/20 rounded-2xl group-hover:scale-110 transition-transform"><Icons.RefreshCw className="w-8 h-8 text-green-400"/></div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Transactions</div>
                                    </button>

                                    <button onClick={() => setActiveTab('database')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-slate-500/50">
                                        <div className="p-4 bg-slate-500/20 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Database className="w-8 h-8 text-slate-300"/></div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Archives</div>
                                    </button>

                                    <button onClick={() => setActiveTab('rants')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-red-500/50">
                                        <div className="p-4 bg-red-500/20 rounded-2xl group-hover:scale-110 transition-transform shadow-lg shadow-red-500/20">
                                            <Icons.MessageSquare className="w-8 h-8 text-red-400"/>
                                        </div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Fan Zone</div>
                                        <div className="text-xs text-slate-400 font-bold">Message Board</div>
                                    </button>

                                    <button onClick={() => setActiveTab('links')} className="glass-panel p-6 rounded-3xl text-center hover:bg-white/5 transition-all group flex flex-col items-center justify-center gap-3 h-48 border border-white/10 hover:border-cyan-500/50">
                                        <div className="p-4 bg-cyan-500/20 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Link className="w-8 h-8 text-cyan-400"/></div>
                                        <div className="font-black text-white text-lg uppercase tracking-wide">Receipts</div>
                                    </button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'news' && (
                            <NewsBoard news={news} onAdd={addNews} onDelete={deleteNews} />
                        )}

                        {activeTab === 'blog' && (
                            <BlogBoard posts={blogPosts} onAdd={addBlogPost} onDelete={deleteBlogPost} currentUser={currentUser} />
                        )}

                        {activeTab === 'media' && (
                            <MediaBoard channels={channels} onAddChannel={addChannel} onDeleteChannel={deleteChannel} />
                        )}

                        {activeTab === 'database' && (
                            <DatabaseBoard years={dbYears} players={dbPlayers} onAddItem={addDatabaseItem} onUpdateItem={updateDatabaseItem} onDeleteItem={deleteDatabaseItem} />
                        )}
                        
                        {activeTab === 'schedule' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="flex justify-between items-end">
                                    <div className="flex items-center gap-4">
                                        <h2 className="text-2xl font-black text-white">{currentSeasonYear} Season Log</h2>
                                        <div className="flex bg-slate-900/50 p-1 rounded-xl border border-white/10">
                                            <button onClick={() => setScheduleMode('Regular')} className={`px-4 py-1 text-xs font-bold rounded-lg transition-all ${scheduleMode === 'Regular' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white'}`}>Regular Season</button>
                                            <button onClick={() => setScheduleMode('Spring')} className={`px-4 py-1 text-xs font-bold rounded-lg transition-all ${scheduleMode === 'Spring' ? 'bg-yellow-600 text-white' : 'text-slate-400 hover:text-white'}`}>Spring Training</button>
                                        </div>
                                        <div className="h-6 w-px bg-white/10 mx-2"></div>
                                        <div className="flex items-center gap-2">
                                            <select className="bg-slate-900/50 border border-white/10 rounded-lg p-1 text-xs font-bold text-white focus:outline-none" value={currentSeasonYear} onChange={(e) => setCurrentSeasonYear(e.target.value)}>
                                                {availableSeasons.map(year => <option key={year} value={year}>{year}</option>)}
                                            </select>
                                            <button onClick={syncSchedule} className="text-xs bg-orange-600/20 text-orange-400 px-2 py-1 rounded hover:bg-orange-600/40 transition-colors border border-orange-600/30 flex items-center gap-1"><Icons.RefreshCw className="w-3 h-3"/> SYNC MLB</button>
                                        </div>
                                    </div>
                                    <div className="glass-panel px-6 py-2 rounded-xl flex gap-6 text-sm font-bold border border-white/10">
                                        <span className="text-green-400">{wins} Wins</span>
                                        <span className="text-slate-600">|</span>
                                        <span className="text-red-400">{losses} Losses</span>
                                    </div>
                                </div>

                                <div className="flex gap-2 overflow-x-auto custom-scrollbar pb-2">
                                    {monthsList.map(month => (
                                        <button 
                                            key={month} 
                                            onClick={() => setFilterMonth(month)}
                                            className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border border-white/5 ${filterMonth === month ? 'bg-blue-600 text-white' : 'bg-slate-900/50 text-slate-400 hover:text-white hover:bg-white/10'}`}
                                        >
                                            {month}
                                        </button>
                                    ))}
                                </div>

                                <div className="glass-panel p-6 rounded-3xl border border-blue-500/30">
                                    <form onSubmit={addScheduleItem} className="flex gap-3 items-end">
                                        <div className="flex-1 space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">Date</label>
                                            <input type="date" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newScheduleItem.date} onChange={e => setNewScheduleItem({...newScheduleItem, date: e.target.value})} required />
                                        </div>
                                        <div className="w-24 space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">Time</label>
                                            <input type="time" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newScheduleItem.time} onChange={e => setNewScheduleItem({...newScheduleItem, time: e.target.value})} />
                                        </div>
                                        <div className="flex-[2] space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">Opponent</label>
                                            <input type="text" placeholder="e.g. Braves" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newScheduleItem.opponent} onChange={e => setNewScheduleItem({...newScheduleItem, opponent: e.target.value})} required />
                                        </div>
                                        <div className="w-32 space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">Location</label>
                                            <select className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newScheduleItem.location} onChange={e => setNewScheduleItem({...newScheduleItem, location: e.target.value})}>
                                                <option value="Home">Home (Citi)</option>
                                                <option value="Away">Away</option>
                                            </select>
                                        </div>
                                        <div className="w-32 space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">Type</label>
                                            <select className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newScheduleItem.gameType} onChange={e => setNewScheduleItem({...newScheduleItem, gameType: e.target.value})}>
                                                <option value="Regular">Regular</option>
                                                <option value="Spring">Spring</option>
                                            </select>
                                        </div>
                                        <button type="submit" className="bg-blue-600 hover:bg-blue-500 text-white font-bold p-3 rounded-xl shadow-lg h-[50px] w-[50px] flex items-center justify-center"><Icons.Plus className="w-6 h-6"/></button>
                                    </form>
                                </div>

                                <div className="grid gap-3">
                                    {filteredGames.map(game => (
                                        <ScheduleCard key={game.id} game={game} onUpdate={updateScheduleItem} onDelete={deleteScheduleItem} />
                                    ))}
                                    {filteredGames.length === 0 && <div className="text-center text-slate-500 py-12">No {scheduleMode} games scheduled for {filterMonth === 'All' ? currentSeasonYear : filterMonth}.</div>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'roster' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="flex justify-between items-center glass-panel p-2 rounded-2xl mb-4 w-full">
                                    <button onClick={() => setRosterMode('squad')} className={`flex-1 py-2 rounded-xl text-sm font-bold transition-all ${rosterMode === 'squad' ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-white'}`}><div className="flex items-center justify-center gap-2"><Icons.Users className="w-4 h-4"/> Depth Chart</div></button>
                                    <button onClick={() => setRosterMode('vibes')} className={`flex-1 py-2 rounded-xl text-sm font-bold transition-all ${rosterMode === 'vibes' ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-white'}`}><div className="flex items-center justify-center gap-2"><Icons.ClipboardList className="w-4 h-4"/> Vibe Check</div></button>
                                </div>

                                {rosterMode === 'squad' && (
                                    <div className="space-y-6">
                                        <h3 className="text-xl font-black text-white mt-8 mb-4 pl-2 border-l-4 border-blue-500">Active 30-Man Roster</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            {['Pitcher', 'Catcher', 'Infield', 'Outfield', 'DH'].map(pos => {
                                                const posPlayers = squad.filter(p => p.position === pos && p.status === 'Active (30-Man)');
                                                if (posPlayers.length === 0) return null;
                                                return (
                                                    <div key={pos} className="glass-panel rounded-3xl overflow-hidden flex flex-col max-h-[600px]">
                                                        <div className="bg-slate-800/50 p-3 text-xs font-black text-slate-400 uppercase tracking-widest border-b border-white/5 shrink-0">{pos}s</div>
                                                        <div className="divide-y divide-white/5 overflow-y-auto custom-scrollbar">
                                                            {posPlayers.map(p => (
                                                                <SquadMember key={p.id} member={p} onUpdate={updateSquadMember} onDelete={deleteSquadMember} />
                                                            ))}
                                                        </div>
                                                    </div>
                                                )
                                            })}
                                        </div>
                                        
                                        <h3 className="text-xl font-black text-slate-300 mt-12 mb-4 pl-2 border-l-4 border-slate-500">40-Man Reserves / Minors</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            {['Pitcher', 'Catcher', 'Infield', 'Outfield', 'DH'].map(pos => {
                                                const posPlayers = squad.filter(p => p.position === pos && p.status === '40-Man / Minors');
                                                if (posPlayers.length === 0) return null;
                                                return (
                                                    <div key={pos} className="glass-panel rounded-3xl overflow-hidden border border-slate-500/30 flex flex-col max-h-[600px]">
                                                        <div className="bg-slate-800/50 p-3 text-xs font-black text-slate-400 uppercase tracking-widest border-b border-white/5 shrink-0">{pos}s</div>
                                                        <div className="divide-y divide-white/5 overflow-y-auto custom-scrollbar">
                                                            {posPlayers.map(p => (
                                                                <SquadMember key={p.id} member={p} onUpdate={updateSquadMember} onDelete={deleteSquadMember} showStatus={true} />
                                                            ))}
                                                        </div>
                                                    </div>
                                                )
                                            })}
                                        </div>

                                        <h3 className="text-xl font-black text-red-400 mt-12 mb-4 pl-2 border-l-4 border-red-500">Injured List (IL)</h3>
                                        <div className="glass-panel rounded-3xl overflow-hidden border border-red-900/30 bg-red-900/5">
                                            <div className="divide-y divide-red-900/20">
                                                {squad.filter(p => p.status === 'Injured List (IL)').map(p => (
                                                    <SquadMember key={p.id} member={p} onUpdate={updateSquadMember} onDelete={deleteSquadMember} />
                                                ))}
                                                {squad.filter(p => p.status === 'Injured List (IL)').length === 0 && <div className="p-4 text-center text-red-400/50 italic text-sm">No injuries. Don't jinx it.</div>}
                                            </div>
                                        </div>
                                        
                                        <h3 className="text-xl font-black text-slate-500 mt-12 mb-4 pl-2 border-l-4 border-slate-700">Former Mets / Archived</h3>
                                        <div className="glass-panel rounded-3xl overflow-hidden border border-slate-800 bg-slate-900/50">
                                            <div className="divide-y divide-slate-800">
                                                {squad.filter(p => p.status === 'Archived / Former Met').map(p => (
                                                    <SquadMember key={p.id} member={p} onUpdate={updateSquadMember} onDelete={deleteSquadMember} isArchived={true} />
                                                ))}
                                                {squad.filter(p => p.status === 'Archived / Former Met').length === 0 && <div className="p-4 text-center text-slate-700 italic text-sm">No former players archived yet.</div>}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {rosterMode === 'vibes' && (
                                    <>
                                        <h3 className="text-xl font-black text-white mb-6">Watch List & Hot Takes</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {players.map(player => (<PlayerCard key={player.id} player={player} onDelete={deletePlayer} />))}
                                            {players.length === 0 && <div className="col-span-full text-center text-slate-500 py-10">Watch list empty. Everyone is average?</div>}
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {activeTab === 'moves' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="glass-panel p-8 rounded-3xl">
                                    <h3 className="text-xl font-black text-white mb-6">Transaction Wire</h3>
                                    <form onSubmit={addTrans} className="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                                        <div className="space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">Transaction Type</label>
                                            <select className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newTrans.type} onChange={e => setNewTrans({...newTrans, type: e.target.value})}>
                                                <option value="Signed">Signed (Arrival)</option>
                                                <option value="Lost">Lost (Departure)</option>
                                                <option value="Trade (Arrival)">Trade (Acquired)</option>
                                                <option value="Trade (Departure)">Trade (Sent Away)</option>
                                                <option value="DFA">DFA (Designated)</option>
                                                <option value="Waivers (Claimed)">Waivers (Claimed)</option>
                                                <option value="Waivers (Lost)">Waivers (Lost)</option>
                                                <option value="Optioned">Optioned (Minors)</option>
                                                <option value="Promoted">Promoted (Call Up)</option>
                                                <option value="IL">IL (Injury)</option>
                                                <option value="Extension">Extension</option>
                                            </select>
                                        </div>
                                        
                                        {['Signed', 'Trade (Arrival)', 'Waivers (Claimed)', 'Extension', 'Draft'].includes(newTrans.type) ? (
                                            <div className="space-y-1">
                                                <label className="text-[10px] uppercase font-bold text-slate-500">Player Name (New/Ext)</label>
                                                <input type="text" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newTrans.player} onChange={e => setNewTrans({...newTrans, player: e.target.value})} placeholder="Name..." />
                                            </div>
                                        ) : (
                                            <div className="space-y-1">
                                                <label className="text-[10px] uppercase font-bold text-slate-500">Select Player (Roster)</label>
                                                <select className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newTrans.playerId || ''} onChange={e => setNewTrans({...newTrans, playerId: e.target.value})}>
                                                    <option value="">-- Select Player --</option>
                                                    {squad.filter(p => p.status !== 'Archived / Former Met').map(p => (
                                                        <option key={p.id} value={p.id}>{p.name} (#{p.number})</option>
                                                    ))}
                                                </select>
                                            </div>
                                        )}

                                        <div className="space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">From Team</label>
                                            <input type="text" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newTrans.fromTeam} onChange={e => setNewTrans({...newTrans, fromTeam: e.target.value})} placeholder="Team..." />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] uppercase font-bold text-slate-500">To Team</label>
                                            <input type="text" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newTrans.toTeam} onChange={e => setNewTrans({...newTrans, toTeam: e.target.value})} placeholder="Team..." />
                                        </div>
                                        <div className="md:col-span-2 flex gap-4">
                                            <input type="text" placeholder="Notes (Contract details, trade package...)" className="flex-1 bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newTrans.notes} onChange={e => setNewTrans({...newTrans, notes: e.target.value})} />
                                            <button type="submit" className="bg-orange-600 hover:bg-orange-500 text-white font-bold px-6 py-3 rounded-xl shadow-lg">Log Move</button>
                                        </div>
                                    </form>
                                    <div className="mt-4 flex justify-end">
                                        <button onClick={syncTransactions} className="text-xs bg-slate-700 text-slate-300 px-4 py-2 rounded-xl hover:bg-slate-600 transition-colors border border-slate-600 flex items-center gap-2 font-bold"><Icons.RefreshCw className="w-3 h-3"/> SYNC TRANSACTIONS</button>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="space-y-4">
                                        <h4 className="text-xs font-black text-green-400 uppercase tracking-widest border-b border-white/10 pb-2">Arrivals / Signed</h4>
                                        {transactions.filter(t => ['Signed', 'Extension', 'Promoted', 'Trade (Arrival)', 'Waivers (Claimed)'].includes(t.type)).map(t => <TransactionCard key={t.id} transaction={t} onDelete={deleteTrans} />)}
                                        {transactions.filter(t => ['Signed', 'Extension', 'Promoted', 'Trade (Arrival)', 'Waivers (Claimed)'].includes(t.type)).length === 0 && <div className="text-sm text-slate-600 italic">Quiet offseason...</div>}
                                    </div>
                                    <div className="space-y-4">
                                        <h4 className="text-xs font-black text-red-400 uppercase tracking-widest border-b border-white/10 pb-2">Departures / Lost</h4>
                                        {transactions.filter(t => ['Lost', 'DFA', 'IL', 'Optioned', 'Trade (Departure)', 'Waivers (Lost)'].includes(t.type)).map(t => <TransactionCard key={t.id} transaction={t} onDelete={deleteTrans} />)}
                                        {transactions.filter(t => ['Lost', 'DFA', 'IL', 'Optioned', 'Trade (Departure)', 'Waivers (Lost)'].includes(t.type)).length === 0 && <div className="text-sm text-slate-600 italic">No one left yet.</div>}
                                    </div>
                                    <div className="space-y-4">
                                        <h4 className="text-xs font-black text-blue-400 uppercase tracking-widest border-b border-white/10 pb-2">Trade Wire / Waivers</h4>
                                        {transactions.filter(t => ['Trade Rumor/News'].includes(t.type)).map(t => <TransactionCard key={t.id} transaction={t} onDelete={deleteTrans} />)}
                                        {transactions.filter(t => ['Trade Rumor/News'].includes(t.type)).length === 0 && <div className="text-sm text-slate-600 italic">Rumor mill is quiet.</div>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'rants' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="glass-panel p-6 rounded-3xl border border-orange-500/30">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-black text-white">Fan Zone Message Board</h3>
                                        {currentUser && (
                                            <button onClick={handleLogout} className="text-xs text-red-400 flex items-center gap-2 hover:text-red-300">
                                                <Icons.LogOut className="w-4 h-4"/> Sign Out
                                            </button>
                                        )}
                                    </div>
                                    
                                    {!currentUser ? (
                                        <div className="flex flex-col gap-6 max-w-md mx-auto py-8">
                                            <form onSubmit={handleEmailAuth} className="space-y-3">
                                                {isSignUp && (
                                                    <input type="text" placeholder="Pick a Username" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={newUsername} onChange={e => setNewUsername(e.target.value)} required />
                                                )}
                                                <input type="email" placeholder="Email Address" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={email} onChange={e => setEmail(e.target.value)} required />
                                                <input type="password" placeholder="Password" className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-orange-500" value={password} onChange={e => setPassword(e.target.value)} required />
                                                
                                                {authError && <div className="text-red-400 text-xs text-center font-bold">{authError}</div>}
                                                
                                                <button type="submit" className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition-colors">
                                                    {isSignUp ? 'Create Account' : 'Sign In'}
                                                </button>
                                                
                                                <div className="flex items-center gap-3 my-2">
                                                    <div className="h-px bg-white/10 flex-1"></div>
                                                    <span className="text-[10px] text-slate-500 font-bold uppercase">OR</span>
                                                    <div className="h-px bg-white/10 flex-1"></div>
                                                </div>

                                                <button type="button" onClick={handleGoogleLogin} className="w-full bg-white text-slate-900 font-bold py-3 rounded-xl hover:bg-slate-200 transition-colors flex items-center justify-center gap-2">
                                                    <svg className="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                                                    Sign in with Google
                                                </button>

                                                <div className="text-center text-xs text-slate-400">
                                                    {isSignUp ? "Already have an account? " : "Don't have an account? "}
                                                    <button type="button" onClick={() => { setIsSignUp(!isSignUp); setAuthError(''); }} className="text-blue-400 hover:underline font-bold">
                                                        {isSignUp ? 'Sign In' : 'Sign Up'}
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    ) : (
                                        <form onSubmit={addRant} className="flex flex-col gap-4">
                                            <div className="flex items-center gap-2 mb-2">
                                                {currentUser.photoURL && <img src={currentUser.photoURL} className="w-8 h-8 rounded-full border border-white/20"/>}
                                                <span className="text-sm text-slate-400">Posting as <strong className="text-white">{currentUser.displayName || currentUser.email}</strong></span>
                                            </div>
                                            <div className="flex flex-col md:flex-row gap-4">
                                                <input type="text" placeholder="Topic (e.g. The Bullpen, The Umpire)" className="bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white flex-1 focus:outline-none focus:border-orange-500" value={newRant.topic} onChange={e => setNewRant({...newRant, topic: e.target.value})} required />
                                                <select className="bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white w-full md:w-auto focus:outline-none focus:border-orange-500" value={newRant.mood} onChange={e => setNewRant({...newRant, mood: e.target.value})}>
                                                    <option value="Neutral">Neutral</option>
                                                    <option value="Happy">Happy / Hype</option>
                                                    <option value="Angry">Angry / Doomer</option>
                                                </select>
                                            </div>
                                            <textarea placeholder="Let it all out..." className="bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white h-32 focus:outline-none focus:border-orange-500" value={newRant.content} onChange={e => setNewRant({...newRant, content: e.target.value})} required />
                                            <button type="submit" className="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-orange-600/20 transition-all">Post Rant</button>
                                        </form>
                                    )}
                                </div>

                                <div className="grid gap-4">
                                    {rants.map(rant => (<RantCard key={rant.id} rant={rant} onDelete={deleteRant} currentUser={currentUser} />))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'links' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="glass-panel p-8 rounded-3xl">
                                    <h3 className="text-xl font-black text-white mb-6">Receipts & Links</h3>
                                    <form onSubmit={addLink} className="flex gap-4">
                                        <input type="text" placeholder="Title (e.g. SNY News)" className="flex-1 bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newLink.title} onChange={e => setNewLink({...newLink, title: e.target.value})} required />
                                        <input type="text" placeholder="URL (https://...)" className="flex-1 bg-slate-900/50 border border-white/10 rounded-xl p-3 text-white focus:outline-none focus:border-blue-500" value={newLink.url} onChange={e => setNewLink({...newLink, url: e.target.value})} required />
                                        <button type="submit" className="bg-slate-700 hover:bg-slate-600 text-white font-bold px-6 py-3 rounded-xl">Add Link</button>
                                    </form>
                                </div>

                                <div className="grid gap-3">
                                    {links.map(link => (<LinkCard key={link.id} link={link} onDelete={deleteLink} />))}
                                    {links.length === 0 && <div className="text-center text-slate-500 py-10">No receipts saved yet.</div>}
                                </div>
                            </div>
                        )}

                    </div>
                    <ChatBox />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
